<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    // Set manual init flag
    window.CMS_MANUAL_INIT = true;
    
    const domain = window.location.hostname;
    
    // Function to determine branch name based on domain patterns
    const getBranchName = (domain) => {
      // Production domains
      const productionDomains = [
        'production--tramundbass.netlify.app',
        'tramundbass.netlify.app',
        'tramundbass.ch',
        'www.tramundbass.ch'
      ];
      
      // Main branch domains
      const mainBranchDomains = [
        'main.tramundbass.ch',
        'main--tramundbass.netlify.app'
      ];
      
      // Check for production domains
      if (productionDomains.includes(domain)) {
        return 'production';
      }
      
      // Check for main branch domains
      if (mainBranchDomains.includes(domain)) {
        return 'main';
      }
      
      // Check for other branch domains
      const branchMatch = domain.match(/^(.+)--tramundbass\.netlify\.app$/);
      if (branchMatch) {
        return branchMatch[1];
      }
      
      // Default to main if no match is found
      return 'main';
    };

    // Get the branch name based on the current domain
    const branchName = getBranchName(domain);
    console.log("init decap ", { branchName });

    // Wait for CMS to be available
    const initCmsWhenReady = () => {
      if (window.CMS) {
        window.CMS.init({
          backend: {
            name: "github",
            branch: branchName,
            repo: "verein-baustell/tram-und-bass",
          },
        });
      } else {
        console.log("Waiting for CMS to load...");
        setTimeout(initCmsWhenReady, 100);
      }
    };

    // Start initialization process when DOM is ready
    document.addEventListener('DOMContentLoaded', initCmsWhenReady);
  </script>
</body>
</html>